# PKgame 今後の修正方針（プロンプト）

## 前提
- 現状はブラウザ版（Spring Boot + Thymeleaf + JS/CSS）で動作している。
- 追加要望は「キーボード入力対応」と「簡易アニメーションの実装」。
- 単一ゲーム状態のまま進め、後でマルチプレイ拡張。

## 目標
1. キーボード操作でシュート/キーパーの入力ができること。
2. コンソール版の簡易アニメーションに相当する演出をブラウザで実装すること。

## ユーザー要望の具体化
- アニメーション: 直線移動でOK。方向に飛ぶ → ゴール or キーパーが弾く/つかむ or バーに弾かれる。
- 速度感: 1フェイズ（キー入力から結果まで）10秒程度。まず実装してから調整。
- 入力: ワンキー入力で即確定。
- 文言: 実況風。

## 実装方針

### 1) キーボード入力対応
- `app.js` に `keydown` リスナーを追加。
- 入力対象キー:
  - `3456789 / wertyuio / sdfghjkl / xcvbnm,`
- `nextAction` に応じて `SHOOT` / `KEEP` を自動判定。
- UI で無効キーは無視。`pending` や `finished` の場合も無視。
- 入力時に対応ボタンを一瞬ハイライト（視覚フィードバック）。

### 2) 簡易アニメーション
コンソール版の「10フレーム移動 + セーブ演出」を簡易に再現する。

#### 必須演出
- ボールがゴールへ移動するアニメーション（CSS transition か JS で座標変更）。
- セーブ時はボールが途中で止まる、または弾かれる演出。
- バー時は上部付近で停止/跳ね返り演出。

#### 実装案
- `app.css` に `.ball` と `.keeper` のアニメーション用クラスを追加。
- `app.js` 側で `lastOutcome` を受け取ったタイミングで:
  - ボール開始座標をリセット
  - ゴールのターゲット位置を算出
  - `requestAnimationFrame` または `setTimeout` で数フレーム移動
- 位置のマッピング:
  - `shotKey` の行/列 → 画面上の x/y へ単純マッピング
  - 1行目: 上、4行目: 下、左右端は左右端へ寄せる

#### 注意
- アニメーション中は入力をロック（`pending` 扱い）。
- アニメーション完了後に結果/コメントを表示。

## 更新対象ファイル
- `src/main/resources/static/app.js`
- `src/main/resources/static/app.css`
- `src/main/resources/templates/index.html`（必要ならクラス追加）

## 受け入れ条件
- キーボード入力でゲームが進行する。
- クリックとキーボードが両方有効。
- 1ターンごとに簡易アニメーションが見える。
- セーブ/バー/ゴールで動きが変わる。
