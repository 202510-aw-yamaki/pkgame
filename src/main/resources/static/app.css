:root {
    --bg: #f5efe6;
    --ink: #1b1a17;
    --accent: #c0352b;
    --accent-2: #1f6f8b;
    --panel: #ffffff;
    --muted: #7a6f5b;
    --field: #f4e4cd;
    --screen-width: min(100vw, 480px);
    --screen-height: min(100vh, calc(var(--screen-width) * 16 / 9));
    --key-size: clamp(26px, 6vw, 38px);
}

* {
    box-sizing: border-box;
}

body {
    margin: 0;
    font-family: "BIZ UDPGothic", "Noto Serif JP", "Yu Mincho", serif;
    color: var(--ink);
    background: radial-gradient(circle at 20% 10%, #fff8ef 0%, #f5efe6 45%, #eee2cf 100%);
}

.viewport {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 12px 0 20px;
    gap: 12px;
}

.screen {
    width: var(--screen-width);
    height: var(--screen-height);
    display: grid;
    grid-template-rows: 11% 9% 44% 11% 25%;
    background: var(--panel);
    border: 2px solid var(--ink);
    box-shadow: 6px 6px 0 var(--ink);
    overflow: hidden;
}

.screen>* {
    min-height: 0;
}

.safe-area {
    width: var(--screen-width);
    height: max(0px, calc(100vh - var(--screen-height)));
    border: 2px dashed rgba(27, 26, 23, 0.15);
    background: linear-gradient(180deg, rgba(255, 255, 255, 0) 0%, rgba(244, 228, 205, 0.4) 100%);
}

.hero {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 12px 0;
    gap: 10px;
}

.hero-title h1 {
    font-size: clamp(20px, 4.4vw, 27px);
    margin: 5px 0 4px;
    letter-spacing: 0.02em;
}

.hero-title p {
    margin: 0;
    color: var(--muted);
    font-size: clamp(11px, 2.4vw, 13px);
}

.badge {
    display: inline-block;
    padding: 2px 8px;
    border: 2px solid var(--ink);
    letter-spacing: 0.2em;
    font-size: 10px;
    background: #fff;
}

.new-match {
    border: 2px solid var(--ink);
    background: var(--accent);
    color: #fff;
    font-size: 11px;
    padding: 6px 10px;
    font-weight: 700;
    box-shadow: 3px 3px 0 var(--ink);
    cursor: pointer;
}

.scoreboard {
    padding: 0 12px;
    display: grid;
    grid-template-columns: auto auto 1fr;
    gap: 6px;
    justify-items: start;
    justify-content: start;
}

.score {
    background: var(--panel);
    border: 2px solid var(--ink);
    padding: 4px 6px;
    text-align: center;
    box-shadow: 2px 2px 0 var(--ink);
    width: auto;
    min-width: 68px;
    justify-self: start;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    gap: 4px;
}

.score .label {
    font-size: 18px;
    letter-spacing: 0.18em;
}

.score .value {
    font-size: 36px;
    font-weight: 700;
}

.meta-card {
    width: 100%;
    display: grid;
    gap: 6px;
}

.meta-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    font-size: 11px;
    gap: 8px;
}

.meta-label {
    color: var(--muted);
    letter-spacing: 0.18em;
    width: 34px;
    flex: 0 0 34px;
    text-align: left;
}

.meta-value {
    font-size: 15px;
    font-weight: 700;
    letter-spacing: 0.14em;
    white-space: nowrap;
    flex: 1 1 auto;
    text-align: left;
}

.arena {
    padding: 6px 12px;
}

.goal-panel {
    height: 100%;
}

.goal {
    position: relative;
    height: 100%;
    border: 2px solid var(--ink);
    background: linear-gradient(160deg, #fef7eb 0%, #f5e6d0 100%);
    overflow: hidden;
}

/* ===== stage ===== */
.pk-stage{
    position:relative;
    width: 100%;
    height: 100%;
    overflow:hidden;
    background:#f3ebdf;
}

/* ===== goal ===== */
.pk-goal{
    --post: clamp(7px, 3.2%, 14px);
    --backpost: calc(var(--post) * .55);
    --dx: 8%;
    --dy: 10%;
    --frontC: #0f0f0f;
    --backC: rgba(0,0,0,.22);
    --minorC: rgba(140,125,105,.35);
    --majorC: rgba(120,105,90,.55);
    --colsMinor: 28;
    --rowsMinor: 16;
    --colsMajor: 14;
    --rowsMajor: 8;
    position:absolute;
    left:50%;
    top:18%;
    width:86%;
    height:56%;
    transform:translateX(-50%);
}

.goal-frame {
    position: absolute;
    left: 50%;
    top: 18%;
    width: 86%;
    height: 56%;
    transform: translateX(-50%);
    pointer-events: none;
    opacity: 0;
}

/* back frame */
.pk-goal__back{
    position:absolute;
    left:var(--dx);
    top:var(--dy);
    width:calc(100% - var(--dx));
    height:calc(100% - var(--dy));
    box-sizing:border-box;
    border:var(--backpost) solid var(--backC);
    border-radius:calc(var(--post) * 1.05);
    background:rgba(255,255,255,.06);
    z-index:1;
}

/* front frame */
/* supports */
.pk-goal__support{
    position:absolute;
    height:calc(var(--post) * .42);
    background:var(--backC);
    border-radius:999px;
    transform-origin:left center;
    z-index:2;
    pointer-events:none;
}

.pk-goal__support--tl{ left:0;  top:0;   width:18%; transform-origin:left center;  transform:rotate(26deg); }
.pk-goal__support--tr{ right:0; top:0;   width:18%; transform-origin:right center; transform:rotate(-26deg); }
.pk-goal__support--bl{ left:0;  bottom:0;width:18%; transform-origin:left center;  transform:rotate(-26deg); }
.pk-goal__support--br{ right:0; bottom:0;width:18%; transform-origin:right center; transform:rotate(26deg); }

/* net */
.pk-goal__net{
    position:absolute;
    inset:calc(var(--post) * 0.95);
    border-radius:calc(var(--post) * 0.9);
    z-index:3;
    pointer-events:none;
    background-image:
        linear-gradient(to right, var(--minorC) 0 1px, transparent 1px),
        linear-gradient(to bottom, var(--minorC) 0 1px, transparent 1px),
        linear-gradient(to right, var(--majorC) 0 1px, transparent 1px),
        linear-gradient(to bottom, var(--majorC) 0 1px, transparent 1px);
    background-size:
        calc(100% / var(--colsMinor)) 100%,
        100% calc(100% / var(--rowsMinor)),
        calc(100% / var(--colsMajor)) 100%,
        100% calc(100% / var(--rowsMajor));
    background-repeat:repeat;
    transform-origin:50% 100%;
    animation: pkNetWave 2.6s ease-in-out infinite;
    filter: drop-shadow(0 1px 0 rgba(0,0,0,.10));
}

@keyframes pkNetWave{
    0%   { transform: skewX(0deg) scaleY(1);     background-position: 0 0, 0 0, 0 0, 0 0; }
    50%  { transform: skewX(-1.8deg) scaleY(.995); background-position: 2px 0, 0 2px, 1px 0, 0 1px; }
    100% { transform: skewX(0deg) scaleY(1);     background-position: 0 0, 0 0, 0 0, 0 0; }
}

/* front posts + bar */
.pk-goal__post, .pk-goal__bar{
    position:absolute;
    background:var(--frontC);
    z-index:5;
    border-radius:999px;
    box-shadow:
        inset 0 2px 0 rgba(255,255,255,.18),
        inset 0 -2px 0 rgba(0,0,0,.25);
}

.pk-goal__post{
    top:0;
    width:var(--post);
    height:100%;
}
.pk-goal__post--l{ left:0; }
.pk-goal__post--r{ right:0; }

.pk-goal__bar{
    left:0;
    top:0;
    width:100%;
    height:var(--post);
}

.pk-goal__bar{ border-top-left-radius:calc(var(--post) * .7); border-top-right-radius:calc(var(--post) * .7); }
.pk-goal__post--l{ border-top-left-radius:calc(var(--post) * .7); }
.pk-goal__post--r{ border-top-right-radius:calc(var(--post) * .7); }

.keeper {
    position: absolute;
    width: 10%;
    height: 12%;
    left: 50%;
    top: 65%;
    transform: translate(-50%, -50%);
    background: #1f6f8b;
    border-radius: 6px;
    box-shadow: inset 0 -2px 0 rgba(0,0,0,.18);
    transition: transform 0.2s ease;
}

.keeper.keeper--left {
    transform: translate(-50%, -50%) rotate(-12deg);
}

.keeper.keeper--right {
    transform: translate(-50%, -50%) rotate(12deg);
}

.keeper.keeper--center {
    transform: translate(-50%, -50%) scale(1.05);
}

.ball {
    position: absolute;
    left: 50%;
    top: 78%;
    transform: translate(-50%, -50%);
    font-size: 16px;
    transition: left 0.6s ease, top 0.6s ease;
}

@media (prefers-reduced-motion: reduce){
    .pk-goal__net{ animation:none !important; }
}

.commentary {
    padding: 6px 12px 4px;
    display: grid;
    grid-template-rows: auto 1fr;
    gap: 4px;
}

.result {
    padding: 8px 10px;
    border: 2px solid var(--ink);
    background: #fff7ef;
    font-weight: 700;
    font-size: clamp(13px, 3.2vw, 17px);
}

.message {
    min-height: 18px;
    color: var(--accent-2);
    font-size: clamp(13px, 3.0vw, 17px);
    font-weight: 700;
}

.meta {
    display: none;
}

.control-panel {
    padding: 6px 12px 10px;
    display: grid;
    grid-template-rows: 1fr auto auto;
    gap: 6px;
    overflow: hidden;
}

.keypad {
    display: grid;
    gap: 4px;
}

.key-row {
    display: grid;
    grid-auto-flow: column;
    gap: 4px;
    justify-content: center;
}

.key {
    width: var(--key-size);
    height: var(--key-size);
    border: 2px solid var(--ink);
    background: #fff;
    font-weight: 700;
    cursor: pointer;
    box-shadow: 2px 2px 0 var(--ink);
}

.key.active {
    background: #fbe3cc;
    transform: translateY(2px);
}

.key:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.actions {
    display: flex;
    justify-content: flex-end;
}

.reset {
    border: 2px solid var(--ink);
    background: var(--accent);
    color: #fff;
    padding: 6px 12px;
    font-weight: 700;
    cursor: pointer;
    box-shadow: 2px 2px 0 var(--ink);
}

.history {
    display: none;
}

.history-title {
    font-size: 12px;
    letter-spacing: 0.2em;
    margin-bottom: 6px;
}

.history-row {
    display: flex;
    gap: 6px;
    flex-wrap: wrap;
}

.history-chip {
    width: 26px;
    height: 26px;
    border: 2px solid var(--ink);
    display: grid;
    place-items: center;
    font-weight: 700;
}

@media (min-width: 900px) {
    :root {
        --screen-width: min(60vw, 520px);
    }

    .history {
        display: grid;
        gap: 10px;
        grid-template-columns: repeat(2, 1fr);
    }
}
